<script>
    // Esto aplica el tema guardado ANTES de que el contenido se pinte
    (function() {
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) {
        document.documentElement.setAttribute("data-theme", savedTheme);
      } else {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute("data-theme", prefersDark ? "dark" : "light");
      }
    })();
    document.documentElement.style.visibility = 'visible';

    function validarTipoSegunCategoria() {
        const categoriaSelect = document.getElementById('categoria');
        const tipoSelect = document.getElementById('tipo');

        if (categoriaSelect && tipoSelect) {
            categoriaSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];

                if (selectedOption.value === '') {
                    // Si no hay categoría seleccionada, habilitar el campo tipo
                    tipoSelect.disabled = false;
                    tipoSelect.value = '';
                    tipoSelect.style.opacity = '1';
                    tipoSelect.style.cursor = 'pointer';
                } else {
                    // Obtener el tipo de la categoría desde el atributo data-tipo
                    const tipoCategoria = selectedOption.getAttribute('data-tipo');

                    if (tipoCategoria) {
                        // Actualizar el valor del tipo
                        tipoSelect.value = tipoCategoria;

                        // Deshabilitar el campo para evitar modificaciones
                        tipoSelect.disabled = true;
                        tipoSelect.style.opacity = '0.7';
                        tipoSelect.style.cursor = 'not-allowed';

                        // Efecto visual para mostrar que se cambió automáticamente
                        tipoSelect.style.borderColor = 'var(--success-color)';
                        tipoSelect.style.boxShadow = '0 0 0 3px rgba(34, 197, 94, 0.1)';

                        setTimeout(() => {
                            tipoSelect.style.borderColor = 'var(--border-color)';
                            tipoSelect.style.boxShadow = 'none';
                        }, 1500);
                    }
                }
            });

            // Verificar estado inicial al cargar la página
            const initialOption = categoriaSelect.options[categoriaSelect.selectedIndex];
            if (initialOption && initialOption.value !== '') {
                const tipoCategoria = initialOption.getAttribute('data-tipo');
                if (tipoCategoria) {
                    tipoSelect.value = tipoCategoria;
                    tipoSelect.disabled = true;
                    tipoSelect.style.opacity = '0.7';
                    tipoSelect.style.cursor = 'not-allowed';
                }
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        validarTipoSegunCategoria();
    });
</script>